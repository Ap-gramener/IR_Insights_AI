<!doctype html>
<html lang="en" data-bs-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Investor Relation Insights</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    crossorigin="anonymous" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="icon" href="https://raw.githubusercontent.com/gramener/assets/main/straive-favicon.svg">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <style>
    body {
      font-size: 0.9rem;
    }

    .display-1 {
      font-size: 3rem;
    }

    .display-6 {
      font-size: 1.25rem;
    }

    .navbar-brand {
      font-size: 1.25rem;
      margin-left: 10px;
      margin-right: 10px;
    }

    .btn {
      font-size: 0.875rem;
    }

    .description {
      font-family: 'Arial', sans-serif;
      /* Change this to your preferred font */
      font-size: 1.2rem;
      /* Adjust the font size as needed */
      font-weight: 400;
      text-align: justify;
      line-height: 1.6;
    }

    .question-box {
      border: 1px solid #ddd;
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
      cursor: pointer;
    }

    .answer-box {
      margin-top: 10px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
      display: none;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 10px 0;
    }

    .drag-area {
      border: 2px dashed #ccc;
      border-radius: 5px;
      padding: 20px;
      text-align: center;
    }

    .drag-area.active {
      border-color: #0d6efd;
      background: #f8f9fa;
    }

    .narrative {
      max-width: 40rem;
    }

    .custom-scrollbar {
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background-color: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      border: 2px solid transparent;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background-color: rgba(0, 0, 0, 0.5);
    }

    .feature-card {
      height: 100%;
      transition: all 0.3s ease;
      border: 1px solid grey;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .feature-card:hover {
      transform: translateY(-5px);
      border-color: green;
      color: green;
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
    }

    .feature-icon {
      font-size: 2rem;
      color: var(--straive-primary);
      margin-bottom: 1rem;
    }

    .questions-list {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .question-box:hover {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg bg-body-tertiary" data-bs-theme="dark">
    <!-- <div class="container-fluid"> -->
    <a class="navbar-brand" href=".">DashBoard</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <div class="nav-item dropdown ms-auto" role="group" aria-label="Toggle dark mode" title="Toggle Dark Mode">
        <button class="dark-theme-toggle btn btn-outline-light dropdown-toggle" type="button" data-bs-toggle="dropdown"
          aria-expanded="false" aria-label="Toggle theme (light)">
          <i class="bi bi-circle-half"></i> <span class="d-lg-none ms-2">Toggle theme</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><button class="dropdown-item active" data-bs-theme-value="light"><i class="me-2 bi bi-sun-fill"></i>
              Light</button></li>
          <li><button class="dropdown-item" data-bs-theme-value="dark"><i class="me-2 bi bi-moon-stars-fill"></i>
              Dark</button></li>
          <li><button class="dropdown-item"><i class="me-2 bi bi-circle-half"></i> Auto</button></li>
        </ul>
      </div>
    </div>
    </div>
  </nav>
  <div id="questions-container" style="display: none;"></div>
  <div class="container-fluid">
    <h1 class="display-1 my-4 text-center">Investor Relation Insights</h1>
    <h2 class="display-6 description">Explore automated earnings call analysis with summaries, key topics, and sentiment
      shifts in analyst and management discussions. Utilise an intelligent Q&A chatbot to efficiently address investor
      inquiries, pulling data from filings, press releases, and reports. Additionally, track competitor earnings,
      compare sentiments, and gain competitive intelligence to stay ahead in the market and optimize your investor
      relations strategy.</h2>
    <br><br>
    <div class="d-flex justify-content-between align-items-center">
      <label class="form-label fw-bold me-2" for="contract" style="font-size: large;">Upload Earnings Call Transcripts
        pdfs</label>
      <div class="mb-3">
        <input type="file" style="width: 900px;" class="form-control" id="contract-file" accept=".pdf" multiple />
      </div>
    </div>

    <div id="summary-container" class="mt-4 mb-4" style="display: none;">
      <div class="card">
        <div class="card-header">
          <h3 class="text-center">Summary of the Transcript</h3>
        </div>
        <div class="card-body">
          <div id="summary-loading" class="text-center" style="display: none;">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p>Generating summary...</p>
          </div>
          <div id="summary-content"></div>
        </div>
      </div>
    </div>

    <!-- Features Grid -->
    <div class="container py-5">
      <div class="row g-3">
        <div class="col-md-6 col-lg-4">
          <div class="card feature-card p-4" onclick="loadQuestions('Financial Performance And Strategy')"
            style="cursor: pointer;">
            <!-- <i class="bi bi-graph-up feature-icon"></i> -->
            <h3 class="h4 mb-3">Financial Performance & Strategy</h3>
            <p class="text-muted">
              Key insights on financial highlights, capital allocation, risks, dividends, guidance, infrastructure, and
              regulatory challenges.
            </p>
          </div>
        </div>
        <div class="col-md-6 col-lg-4">
          <div class="card feature-card p-4" onclick="loadQuestions('Investor Sentiment And Concerns')"
            style="cursor: pointer;">
            <!-- <i class="bi bi-lightning feature-icon"></i> -->
            <h3 class="h4 mb-3">Investor Sentiment & Concerns</h3>
            <p class="text-muted">
              Analysis of investor concerns, management tone, analyst questions, and sentiment on debt and cash flow
              sustainability. </p>
          </div>
        </div>
        <div class="col-md-6 col-lg-4">
          <div class="card feature-card p-4" onclick="loadQuestions('Business Operations And Growth')"
            style="cursor: pointer;">
            <!-- <i class="bi bi-diagram-3 feature-icon"></i> -->
            <h3 class="h4 mb-3">Business Operations & Growth</h3>
            <p class="text-muted">
              Companyâ€™s growth plans in key sectors, macroeconomic strategies, M&A activity, and integration of new
              assets. </p>
          </div>
        </div>
        <div class="col-md-6 col-lg-4">
          <div class="card feature-card p-4" onclick="loadQuestions('Performance Comparison')" style="cursor: pointer;">
            <!-- <i class="bi bi-clock-history feature-icon"></i> -->
            <h3 class="h4 mb-3">Performance Comparison</h3>
            <p class="text-muted">
              Comparison of capital expenditure, investor concerns, and leverage ratios with competitors in the
              industry. </p>
          </div>
        </div>
        <div class="col-md-6 col-lg-4">
          <div class="card feature-card p-4"
            onclick="loadQuestions('Comprehensive Insights From Multiple Data Sources')" style="cursor: pointer;">
            <!-- <i class="bi bi-link-45deg feature-icon"></i> -->
            <h3 class="h4 mb-3">Comprehensive Insights from Multiple Data Sources</h3>
            <p class="text-muted">
              Comprehensive insights into financials, sentiment trends, and long-term outlook from various data sources.
            </p>
          </div>
        </div>
        <!-- <div class="col-md-6 col-lg-4">
          <a class="card feature-card p-4" href="regulatoryforesight.html" style="text-decoration: none;">
            <i class="bi bi-shield-check feature-icon"></i>
            <h3 class="h4 mb-3">Regulatory Foresight</h3>
            <p class="text-muted">
              Analyze upcoming policies and regulations to forecast their impact on investments.
            </p>
          </a>
        </div>
        <div class="col-md-6 col-lg-4">
          <a class="card feature-card p-4" href="https://gramener.com/docsearch/creditresearch/"
            style="text-decoration: none;">
            <i class="bi bi-chat-dots feature-icon"></i>
            <h3 class="h4 mb-3">Chat with AI</h3>
            <p class="text-muted">
              Talk with our powerful AI tool to observe valuable insights.
            </p>
          </a>
        </div> -->
      </div>
    </div>
  </div>

  <!-- <div class="container" id="questions-container"></div> -->

  <!-- Footer -->
  <footer class="my-5 vh-100 d-flex align-items-center justify-content-center">
    <h1 class="display-4">Designed by <a href="https://www.straive.com/"
        class="text-reset link-offset-3 link-underline link-underline-opacity-25">Straive</a></h1>
  </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" type="module"></script>
  <script src='https://cdn.jsdelivr.net/gh/FThompson/FormPersistence.js@2.0.6/form-persistence.min.js'></script>
  <script src="https://cdn.jsdelivr.net/npm/@gramex/ui@0.3/dist/dark-theme.js" type="module"></script>
  <script>
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    // Function to set light theme
    function setLightTheme() {
      document.documentElement.setAttribute('data-bs-theme', 'light');
      updateThemeButtons('light');
    }

    // Function to set dark theme
    function setDarkTheme() {
      document.documentElement.setAttribute('data-bs-theme', 'dark');
      updateThemeButtons('dark');
    }

    // Function to update theme button active states
    function updateThemeButtons(activeTheme) {
      const themeButtons = document.querySelectorAll('[data-bs-theme-value]');
      themeButtons.forEach(button => {
        if (button.getAttribute('data-bs-theme-value') === activeTheme) {
          button.classList.add('active');
        } else {
          button.classList.remove('active');
        }
      });
    }

    // Event listeners for theme buttons
    document.addEventListener('DOMContentLoaded', () => {
      const themeButtons = document.querySelectorAll('[data-bs-theme-value]');

      themeButtons.forEach(button => {
        button.addEventListener('click', () => {
          const theme = button.getAttribute('data-bs-theme-value');

          switch (theme) {
            case 'light':
              setLightTheme();
              break;
            case 'dark':
              setDarkTheme();
              break;
            case 'auto':
              // Remove theme attribute to use system preference
              document.documentElement.removeAttribute('data-bs-theme');
              updateThemeButtons('auto');
              break;
          }
        });
      });

      // Set light theme by default
      setLightTheme();
    });

    let uploadedFiles = [];

    // Handle file uploads
    document.getElementById('contract-file').addEventListener('change', async (event) => {
      uploadedFiles = Array.from(event.target.files);
      if (uploadedFiles.length > 0) {
        await generateSummary();
      }
    });

    async function extractTextFromPDF(file) {
      return new Promise(async (resolve) => {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let fullText = '';

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(item => item.str).join(' ');
          fullText += pageText + ' ';
        }

        resolve({
          filename: file.name,
          content: fullText
        });
      });
    }

    async function generateSummary() {
      const summaryContainer = document.getElementById('summary-container');
      const summaryLoading = document.getElementById('summary-loading');
      const summaryContent = document.getElementById('summary-content');

      summaryContainer.style.display = 'block';
      summaryLoading.style.display = 'block';
      summaryContent.innerHTML = '';

      try {
        // Process PDFs and extract text
        const pdfTexts = await Promise.all(uploadedFiles.map(file => extractTextFromPDF(file)));

        const systemPrompt = `You are an AI assistant specialized in analyzing earnings call transcripts. 
    Please provide a comprehensive summary of the transcripts and perform sentiment analysis in the whole summary(highlight positive statements in green and negative statements in red). 
    Format your response in HTML with the following structure:
    1. Overall Summary (2-3 paragraphs)
    2. Key Points (bullet points)`;

        const userPrompt = `Please analyze these earnings call transcripts and provide a structured summary with sentiment analysis:
    ${pdfTexts.map(pdf => `${pdf.filename}:\n${pdf.content}`).join('\n\n')}`;

        const response = await fetch("https://llmfoundry.straive.com/openai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              {
                role: "system",
                content: systemPrompt
              },
              {
                role: "user",
                content: userPrompt
              }
            ],
          }),
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        let summary = data.choices[0].message.content;

        // Process the summary to add color highlighting
        summary = summary.replace(/positive:([^.!?]*[.!?])/gi, '<span style="color: green">$1</span>');
        summary = summary.replace(/negative:([^.!?]*[.!?])/gi, '<span style="color: red">$1</span>');

        // Format the summary with proper HTML structure
        summaryContent.innerHTML = `
      <div class="summary-text">
        ${summary}
      </div>
    `;

      } catch (error) {
        console.error('Error generating summary:', error);
        summaryContent.innerHTML = `
      <div class="alert alert-danger">
        Error generating summary: ${error.message}. Please try again.
      </div>
    `;
      } finally {
        summaryLoading.style.display = 'none';
      }
    }

    // Add some CSS styles
    const styles = `
  .summary-text {
    font-size: 1rem;
    line-height: 1.6;
  }
  .summary-text ul {
    margin-top: 1rem;
    margin-bottom: 1rem;
  }
  .summary-text li {
    margin-bottom: 0.5rem;
  }
`;

    // Add the styles to the document
    const styleSheet = document.createElement("style");
    styleSheet.innerText = styles;
    document.head.appendChild(styleSheet);

    // Add this function to handle navigation
    function updateBreadcrumb(category) {
      const navbar = document.querySelector('.navbar-brand');
      if (category) {
        navbar.innerHTML = `DashBoard > ${category}`;
      } else {
        navbar.innerHTML = 'DashBoard';
      }
    }

    // Function to show original content
    function showOriginalContent() {
      const mainContent = document.querySelector('.container-fluid');
      const questionsContainer = document.getElementById('questions-container');

      // Show original content
      mainContent.style.display = 'block';
      // Clear and hide questions container
      questionsContainer.innerHTML = '';
      questionsContainer.style.display = 'none';
      // Reset breadcrumb
      updateBreadcrumb();
    }

    async function loadQuestions(category) {
      try {
        const mainContent = document.querySelector('.container-fluid');
        const questionsContainer = document.getElementById('questions-container');
        const footer = document.querySelector('footer');

        // Hide all content except nav (nav is outside container-fluid)
        mainContent.style.display = 'none';
        // Show questions container
        questionsContainer.style.display = 'block';
        // Keep footer visible
        footer.style.display = 'flex';

        // Update breadcrumb
        updateBreadcrumb(category);

        const response = await fetch('questions.json');
        const data = await response.json();
        const questions = data[category];

        questionsContainer.innerHTML = `
      <div class="container">
        <h1 class="display-1 my-4 text-center">${category}</h1>
        <div class="questions-list">
    `;

        questions.forEach((question, index) => {
          questionsContainer.innerHTML += `
        <div class="question-box" id="question-${index}">
          <h4>${question}</h4>
          <div class="loading" id="loading-${index}" style="display: none;">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
          <div class="answer-box" id="answer-${index}"></div>
        </div>
      `;
        });

        questionsContainer.innerHTML += '</div></div>';

        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });

        // Add click handlers to questions
        questions.forEach((question, index) => {
          document.getElementById(`question-${index}`).addEventListener('click', () => {
            handleQuestionClick(question, index);
          });
        });
      } catch (error) {
        console.error('Error loading questions:', error);
      }
    }

    // Add click handler to Dashboard link
    // document.addEventListener('DOMContentLoaded', () => {
    //   const dashboardLink = document.querySelector('.navbar-brand');
    //   dashboardLink.addEventListener('click', (e) => {
    //     e.preventDefault();
    //     showOriginalContent();
    //   });
    // });

    async function handleQuestionClick(question, index) {
      const answerBox = document.getElementById(`answer-${index}`);
      const loadingIndicator = document.getElementById(`loading-${index}`);

      // If answer is already shown, toggle it
      if (answerBox.style.display === 'block') {
        answerBox.style.display = 'none';
        return;
      }

      // Check if files are uploaded
      if (uploadedFiles.length === 0) {
        alert('Please upload PDF files first');
        return;
      }

      // Show loading indicator
      loadingIndicator.style.display = 'block';
      answerBox.style.display = 'none';

      try {
        // Process PDFs and extract text
        const pdfTexts = await Promise.all(uploadedFiles.map(file => extractTextFromPDF(file)));

        // Construct the system prompt
        const systemPrompt = `You are an AI assistant specialized in analyzing earnings call transcripts. 
    Analyze the provided transcripts and answer questions about financial performance, business strategy, and market trends.
    Base your answers only on the information provided in the transcripts.`;

        // Construct the user prompt
        const userPrompt = `Based on the following earnings call transcripts:
    ${pdfTexts.map(pdf => `${pdf.filename}:\n${pdf.content}`).join('\n\n')}
    
    Please answer this question: ${question}`;

        const response = await fetch("https://llmfoundry.straive.com/openai/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          credentials: "include",
          body: JSON.stringify({
            model: "gpt-4o-mini",
            messages: [
              {
                role: "system",
                content: systemPrompt
              },
              {
                role: "user",
                content: userPrompt
              }
            ],
          }),
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();

        // Format and display the answer
        const formattedAnswer = data.choices[0].message.content
          .split('\n')
          .map(line => `<p>${line}</p>`)
          .join('');

        // Hide loading indicator and show answer
        loadingIndicator.style.display = 'none';
        answerBox.style.display = 'block';
        answerBox.innerHTML = formattedAnswer;

      } catch (error) {
        console.error('Error getting answer:', error);
        loadingIndicator.style.display = 'none';
        answerBox.style.display = 'block';
        answerBox.innerHTML = `<p class="text-danger">Error: ${error.message}. Please try again.</p>`;
      }
    }
  </script>
</body>

</html>